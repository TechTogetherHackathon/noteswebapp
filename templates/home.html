<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="../static/styles.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>

<body>
    <div class="zone">
        <div id="dropZ">
            <div style="font-size: 250px; margin-bottom: 0px">
                <i class="fa fa-cloud-upload"></i>
            </div>
            <div class="drag">
                <h1>Drag and drop your file here</h1>
                <h2>Or</h2>
            </div>
            <input type="file" name="file" id="file" class="inputfile" />
            <label for="file">Choose a file</label>
            <button id="clicked" onclick="myFunction()">Submit</button>
            <p>File size limit : 10 MB</p>
        </div>
    </div>
    <div class="show-data">
    </div>

    </div>
    <script>
        function myFunction(input) {
            var input = $('#file').val();
            var summary = ""
            console.log(input)
            $.ajax({
                url: "/upload",
                type: "POST",
                data: {
                    input: input
                }
            }).done(function (response) {
                transcript = response.transcript
                summary = response.summary;
                console.log("done")
            }).then(() => {
                var url = "http://127.0.0.1:5000/transcribe/" + transcript + "?" + summary
                window.location.href = url

                console.log("done2");
            });

        }


        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $(".image-upload-wrap").hide();

                    $(".file-upload-image").attr("src", e.target.result);
                    $(".file-upload-content").show();

                    $(".image-title").html(input.files[0].name);
                };

                reader.readAsDataURL(input.files[0]);
                console.log("reading url")
                return input.files[0]
            } else {
                removeUpload();
            }
        }

        function removeUpload() {
            $(".file-upload-input").replaceWith($(".file-upload-input").clone());
            $(".file-upload-content").hide();
            $(".image-upload-wrap").show();
        }
        $(".image-upload-wrap").bind("dragover", function () {
            $(".image-upload-wrap").addClass("image-dropping");
        });
        $(".image-upload-wrap").bind("dragleave", function () {
            $(".image-upload-wrap").removeClass("image-dropping");
        });

    </script>
</body>

</html>